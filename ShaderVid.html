<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CyberPlayer 3000 Shader Edition</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
            font-family: Arial, sans-serif;
        }
        #shaderCanvas {
            width: 100%;
            height: 100%;
        }
        #fileInput {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 10;
        }
        #videoElement {
            display: none;
        }
    </style>
</head>
<body>
    <canvas id="shaderCanvas"></canvas>
    <input type="file" id="fileInput" multiple accept=".mp4,.webm,.ogg">
    <video id="videoElement" loop>
        <source src="" type="video/mp4">
        Your browser does not support the video tag.
    </video>

    <script id="vertexShader" type="x-shader/x-vertex">
        varying vec2 vUv;
        void main() {
            vUv = uv;
            gl_Position = vec4(position, 1.0);
        }
    </script>

    <script id="fragmentShader" type="x-shader/x-fragment">
        uniform vec2 u_resolution;
        uniform float u_time;
        uniform sampler2D u_videoTexture;
        uniform vec2 u_mouse;
        uniform float u_videoAspect;
        uniform int u_playlistSize;
        uniform int u_currentVideo;
        varying vec2 vUv;

        vec3 neon(vec3 color, float intensity) {
            return color * intensity / (distance(vUv, vec2(0.5)) + 0.5);
        }

        void main() {
            vec2 uv = gl_FragCoord.xy / u_resolution.xy;
            vec3 color = vec3(0.0);

            // Background effect
            vec2 center = vec2(0.5);
            float d = distance(uv, center);
            vec3 bgColor = mix(vec3(0.1, 0.0, 0.2), vec3(0.0, 0.1, 0.2), d);
            color += bgColor;

            // Grid effect
            vec2 grid = fract(uv * 20.0 + sin(u_time * 0.1) * 0.5);
            float gridLine = step(0.95, max(grid.x, grid.y));
            color += vec3(0.0, 1.0, 1.0) * gridLine * 0.2;

            // Video player area
            if(uv.x < 0.7 && uv.y > 0.1) {
                vec2 videoUV = (uv - vec2(0.0, 0.1)) / vec2(0.7, 0.9);
                if(videoUV.x >= 0.0 && videoUV.x <= 1.0 && videoUV.y >= 0.0 && videoUV.y <= 1.0) {
                    vec2 aspectCorrectedUV = videoUV;
                    aspectCorrectedUV.y = (aspectCorrectedUV.y - 0.5) * u_videoAspect + 0.5;
                    if(aspectCorrectedUV.y >= 0.0 && aspectCorrectedUV.y <= 1.0) {
                        vec4 videoColor = texture2D(u_videoTexture, aspectCorrectedUV);
                        color = mix(color, videoColor.rgb, videoColor.a);
                    }
                }
            }

            // Playlist area
            if(uv.x > 0.7) {
                float playlistItemHeight = 0.1;
                int itemIndex = int(floor(uv.y / playlistItemHeight));
                if(itemIndex < u_playlistSize) {
                    vec3 itemColor = (itemIndex == u_currentVideo) ? vec3(0.0, 1.0, 1.0) : vec3(0.5);
                    color = mix(color, itemColor, 0.7);
                    
                    // Highlight on hover
                    vec2 mouseUV = u_mouse / u_resolution;
                    if(mouseUV.x > 0.7 && abs(mouseUV.y - uv.y) < playlistItemHeight / 2.0) {
                        color = mix(color, vec3(1.0), 0.3);
                    }
                }
            }

            // Header
            if(uv.y < 0.1) {
                color = mix(color, vec3(0.0, 0.5, 0.5), 0.8);
                // Add text effect for "CyberPlayer 3000"
                if(uv.x > 0.05 && uv.x < 0.35 && uv.y > 0.03 && uv.y < 0.07) {
                    color = neon(vec3(0.0, 1.0, 1.0), 1.5);
                }
            }

            // Add some glow and scanlines
            color += neon(vec3(0.0, 1.0, 1.0), 0.2);
            color *= 0.8 + 0.2 * sin(uv.y * 1000.0 + u_time * 5.0);

            gl_FragColor = vec4(color, 1.0);
        }
    </script>

    <script>
        let camera, scene, renderer, uniforms;
        let playlist = [];
        let currentVideoIndex = 0;
        let videoTexture, videoElement;

        function init() {
            camera = new THREE.Camera();
            camera.position.z = 1;

            scene = new THREE.Scene();

            const geometry = new THREE.PlaneBufferGeometry(2, 2);

            videoElement = document.getElementById('videoElement');
            videoTexture = new THREE.VideoTexture(videoElement);

            uniforms = {
                u_time: { type: "f", value: 1.0 },
                u_resolution: { type: "v2", value: new THREE.Vector2() },
                u_mouse: { type: "v2", value: new THREE.Vector2() },
                u_videoTexture: { type: "t", value: videoTexture },
                u_videoAspect: { type: "f", value: 16 / 9 },
                u_playlistSize: { type: "i", value: 0 },
                u_currentVideo: { type: "i", value: 0 }
            };

            const material = new THREE.ShaderMaterial({
                uniforms: uniforms,
                vertexShader: document.getElementById('vertexShader').textContent,
                fragmentShader: document.getElementById('fragmentShader').textContent
            });

            const mesh = new THREE.Mesh(geometry, material);
            scene.add(mesh);

            renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('shaderCanvas') });
            renderer.setPixelRatio(window.devicePixelRatio);

            onWindowResize();
            window.addEventListener('resize', onWindowResize, false);
            document.addEventListener('mousemove', onMouseMove, false);
            document.addEventListener('click', onClick, false);

            document.getElementById('fileInput').addEventListener('change', handleFileInput);
        }

        function onWindowResize() {
            renderer.setSize(window.innerWidth, window.innerHeight);
            uniforms.u_resolution.value.x = renderer.domElement.width;
            uniforms.u_resolution.value.y = renderer.domElement.height;
        }

        function onMouseMove(event) {
            uniforms.u_mouse.value.x = event.clientX;
            uniforms.u_mouse.value.y = window.innerHeight - event.clientY;
        }

        function onClick(event) {
            const uv = {
                x: event.clientX / window.innerWidth,
                y: 1 - (event.clientY / window.innerHeight)
            };

            if(uv.x > 0.7) {
                const itemHeight = 0.1;
                const itemIndex = Math.floor(uv.y / itemHeight);
                if(itemIndex < playlist.length) {
                    currentVideoIndex = itemIndex;
                    playVideo(playlist[currentVideoIndex]);
                }
            }
        }

        function handleFileInput(event) {
            const files = event.target.files;
            playlist = Array.from(files).filter(file => file.type.startsWith('video/'));
            uniforms.u_playlistSize.value = playlist.length;
            if(playlist.length > 0) {
                currentVideoIndex = 0;
                playVideo(playlist[0]);
            }
        }

        function playVideo(file) {
            const videoURL = URL.createObjectURL(file);
            videoElement.src = videoURL;
            videoElement.play();
            uniforms.u_currentVideo.value = currentVideoIndex;
        }

        function animate() {
            requestAnimationFrame(animate);
            uniforms.u_time.value += 0.05;
            renderer.render(scene, camera);
        }

        init();
        animate();
    </script>
</body>
</html>