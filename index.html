<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="styles.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Open+Sans:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <title>Reproductor de video de YouTube</title>
  </head>
  <style>
    :root {
      --rojo: #e50914;
      --fondo: #141414;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: var(--fondo);
      font-family: "Open Sans", sans-serif;
    }

    .contenedor {
      width: 90%;
      margin: auto;
    }

    header {
      padding: 30px 0;
    }

    header .contenedor {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    header .logotipo {
      font-family: "Bebas Neue", cursive;
      font-weight: normal;
      color: var(--rojo);
      font-size: 40px;
    }

    header nav a {
      color: #aaa;
      text-decoration: none;
      margin-right: 20px;
    }

    header nav a:hover,
    header nav a.activo {
      color: #fff;
    }

    /* ---- ----- ----- Pelicula Principal ----- ----- ----- */
    .pelicula-principal {
      font-size: 16px;
      min-height: 40.62em;
      color: #fff;
      background: linear-gradient(
          rgba(0, 0, 0, 0.5) 0%,
          rgba(0, 0, 0, 0.5) 100%
        ),

      background-position: center center;
      background-size: cover;
      margin-bottom: 3.12em;
      display: flex;
      align-items: end;
    }

    .pelicula-principal .contenedor {
      margin: 0 auto;
      margin-bottom: 6.25em;
    }

    .pelicula-principal .titulo {
      font-weight: 600;
      font-size: 3.12em;
      margin-bottom: 0.4em;
    }

    .pelicula-principal .descripcion {
      font-weight: normal;
      font-size: 1em;
      line-height: 1.75em;
      max-width: 50%;
      margin-bottom: 1.25em;
    }

    .pelicula-principal .boton {
      background: rgba(0, 0, 0, 0.5);
      border: none;
      border-radius: 0.31em;
      padding: 0.93em 1.87em;
      color: #fff;
      margin-right: 1.25em;
      cursor: pointer;
      transition: 0.3s ease all;
      font-size: 1.12em;
    }

    .pelicula-principal .boton:hover {
      background: #fff;
      color: #000;
    }

    .pelicula-principal .boton i {
      margin-right: 1.25em;
    }

    /* ---- ----- ----- Contenedor Titulo y controles    ----- ----- ----- */

    .contenedor-titulo-controles {
      display: flex;
      justify-content: space-between;
      align-items: end;
    }

    .contenedor-titulo-controles h3 {
      color: #ffffff;
      font-size: 30px;
    }
    .contenedor-titulo-controles .indicadores button {
      background: white;
      height: 3px;
      width: 10px;
      cursor: pointer;
      border: none;
      margin-right: 2px;
    }

    .contenedor-titulo-controles .indicadores button:hover,
    .contenedor-titulo-controles .indicadores button.activo {
      background: red;
    }

    /* ---- ----- ----- Contenedor principal y flechas    ----- ----- ----- */

    .peliculas-recomendadas {
      margin-bottom: 70px;
    }

    .peliculas-recomendadas .contenedor-principal {
      display: flex;
      align-items: center;
      position: relative;
    }

    .peliculas-recomendadas .contenedor-principal .flecha-izquierda,
    .peliculas-recomendadas .contenedor-principal .flecha-derecha {
      position: absolute;
      border: none;
      background: rgba(0, 0, 0, 0.3);
      font-size: 40px;
      height: 50%;
      top: calc(50% -25%);
      line-height: 40px;
      width: 50px;
      color: #fff;
      cursor: pointer;
      z-index: 500;
      transition: 0.2 ease all;
    }

    .peliculas-recomendadas .contenedor-principal .flecha-izquierda:hover,
    .peliculas-recomendadas .contenedor-principal .flecha-derecha:hover {
      background: rgba(0, 0, 0, 0.9);
    }

    .peliculas-recomendadas .contenedor-principal .flecha-izquierda {
      left: 0;
    }
    .peliculas-recomendadas .contenedor-principal .flecha-derecha {
      right: 0;
    }

    /* ---- ----- ----- pelicula-principal y flechas    ----- ----- ----- */

    .pelicula-principal .contenedor {
      margin-bottom: 70px;
    }

    .pelicula-principal .contenedor  .contenedor-principal {
      display: flex;
      align-items: center;
      position: relative;
    }

    .pelicula-principal .contenedor  .contenedor-principal .flecha-izquierda,
    .pelicula-principal .contenedor  .contenedor-principal .flecha-derecha {
      position: absolute;
      border: none;
      background: rgba(0, 0, 0, 0.3);
      font-size: 40px;
      height: 50%;
      top: calc(50% -25%);
      line-height: 40px;
      width: 50px;
      color: #fff;
      cursor: pointer;
      z-index: 500;
      transition: 0.2 ease all;
    }

    .pelicula-principal .contenedor  .contenedor-principal .flecha-izquierda:hover,
    .pelicula-principal .contenedor  .contenedor-principal .flecha-derecha:hover {
      background: rgba(0, 0, 0, 0.9);
    }

    .pelicula-principal .contenedor  .contenedor-principal .flecha-izquierda {
      left: 0;
    }
    .pelicula-principal .contenedor  .contenedor-principal .flecha-derecha {
      right: 0;
    }

    /* ---- ----- ----- Carrusel    ----- ----- ----- */

    .peliculas-recomendadas .contenedor-carousel {
      width: 100%;
      padding: 20px 0;
      overflow-x: hidden;
      scroll-behavior: smooth;
    }

    .peliculas-recomendadas .contenedor-carousel .carousel {
      display: flex;
      flex-wrap: nowrap;
    }

    .peliculas-recomendadas .contenedor-carousel .carousel .pelicula {
      min-width: 20%; /*FIX SIZE IMGS 5 PICS*/
      transition: 0.3 ease all;
      box-shadow: 5px 5px 10px rgba(0, 0, 0, 0.3);
    }

    .peliculas-recomendadas .contenedor-carousel .carousel .pelicula.hover {
      transform: scale(1.2);
      transform-origin: center;
    }

    .peliculas-recomendadas .contenedor-carousel .carousel .pelicula img {
      width: 100%;
      vertical-align: top;
    }

    /* ---- ----- ----- Media Queries ----- ----- ----- */
    @media screen and (max-width: 800px) {
      header .logotipo {
        margin-bottom: 10px;
        font-size: 30px;
      }

      header .contenedor {
        flex-direction: column;
        text-align: center;
      }

      .pelicula-principal {
        font-size: 14px;
      }

      .pelicula-principal .descripcion {
        max-width: 100%;
      }

      .peliculas-recomendadas .contenedor-carousel {
        overflow: visible;
      }

      .peliculas-recomendadas .contenedor-carousel .carousel {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 20px;
      }

      .peliculas-recomendadas .indicadores,
      .peliculas-recomendadas .flecha-derecha,
      .peliculas-recomendadas .flecha-izquierda {
        display: none;
      }
    }
  </style>
  <style>
    .peliculas-recomendadas .contenedor-carousel {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100%;
    }
    .peliculas-recomendadas .contenedor-carousel .carousel {
      display: flex;
      justify-content: center;
      align-items: center;
      overflow-x: auto;
      width: 100%;
      margin: 0;
      padding: 0;
      list-style: none;
      -webkit-overflow-scrolling: touch;
    }
    .peliculas-recomendadas .contenedor-carousel .carousel .pelicula {
      min-width: 20%; /*FIX SIZE IMGS 5 PICS*/
      transition: 0.3 ease all;
      box-shadow: 5px 5px 10px rgba(0, 0, 0, 0.3);
      margin: 0 5px;
    }
    .peliculas-recomendadas .contenedor-carousel .carousel .pelicula.hover {
      transform: scale(0.8);
      transform-origin: center;
    }

    .peliculas-recomendadas .contenedor-carousel .carousel .pelicula img {
      width: 100%;
      max-width: 100%;
      vertical-align: top;
    }
  </style>
  <body>
    <header>
      <div class="contenedor">
        <h2 class="logotipo">SERGEINDAMIX</h2>
        <nav>
          <a href="#" class="activo">Inicio</a>
          <a href="shadertoy.html">Programas</a>
          <a href="echo.html">Películas</a>
          <a href="halftone.html">Más Recientes</a>
          <a href="changeImage.html">Mi lista</a>
        </nav>
      </div>
    </header>

    <main>
      <div class="pelicula-principal">
        <div class="contenedor">
          <h3 class="titulo">¡Reproductor de videos commercial free!</h3>
          <div class="contenedor-principal">
            <button
              role="button"
              id="flecha-izquierda"
              class="flecha-izquierda"
            >
              <i class="fas fa-angle-left"></i>
            </button>

            <div id="player"></div>

            <button role="button" id="flecha-derecha" class="flecha-derecha">
              <i class="fas fa-angle-right"></i>
            </button>
          </div>

          <p id="description" class="descripcion">
            ¿Cansado de los anuncios en tus videos favoritos? En nuestro
            reproductor de videos, puedes disfrutar de todo el contenido que
            quieras sin interrupciones comerciales. ¡Explora nuestra amplia
            selección de videos y disfruta de una experiencia de visualización
            sin molestias!
          </p>
          <input type="file" id="inputFile" accept=".txt" />
          <button id="loadButton">Cargar videos</button>
          <input
            type="text"
            id="videoLinkInput"
            placeholder="Ingresa el enlace de un video de YouTube"
          />
          <button id="updateButton">Actualizar video</button>
          <button onclick="detectarEnlace()">Detectar enlace</button>
          <p id="errorMessage" style="color: red; display: none">
            El enlace ingresado no es válido
          </p>
          <button id="playlistButton">Agregar lista de reproducción</button>
          <select id="videoList"></select>

          <button role="button" class="boton">
            <i class="fas fa-play"></i>Reproducir
          </button>
          <button role="button" class="boton">
            <i class="fas fa-info-circle"></i>Más información
          </button>
        </div>
      </div>

      <div class="peliculas-recomendadas contenedor">
        <div class="contenedor-titulo-controles">
          <h3>Videos Google Drive</h3>
          <div class="indicadores"></div>
        </div>

        <div class="contenedor-principal">
          <button role="button" id="flecha-izquierda" class="flecha-izquierda">
            <i class="fas fa-angle-left"></i>
          </button>

          <div id="videosContainer" class="contenedor-carousel"></div>

          <button role="button" id="flecha-derecha" class="flecha-derecha">
            <i class="fas fa-angle-right"></i>
          </button>
        </div>
      </div>
<iframe width="560" height="315" src="https://www.youtube.com/embed/G16UZVC_Gp8" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

      <script src="https://www.youtube.com/iframe_api"></script>
    </main>

    <script
      src="https://kit.fontawesome.com/2c36e9b7b1.js"
      crossorigin="anonymous"
    ></script>
    <script>
      let player;
      let videoLinkInput = document.getElementById("videoLinkInput");
      let updateButton = document.getElementById("updateButton");
      let playlistButton = document.getElementById("playlistButton");
      let errorMessage = document.getElementById("errorMessage");
      let description = document.getElementById("description");
      let videoList = document.getElementById("videoList");
      let titulo = document.querySelector(".titulo");

      function onYouTubeIframeAPIReady() {
        player = new YT.Player("player", {
          height: "720",
          width: "1024",
          videoId: "1-3L7Uw5yEs",
          playerVars: {
            autoplay: 1,
            controls: 1,
            modestbranding: 1,
            rel: 1,
            showinfo: 1,
          },
          events: {
            onReady: onPlayerReady,
            onStateChange: onPlayerStateChange,
          },
        });
      }

      function onPlayerReady(event) {
        event.target.playVideo();
      }

      function onPlayerStateChange(event) {
        if (event.data === YT.PlayerState.ENDED) {
          let currentVideoIndex = player.getPlaylistIndex();
          let nextVideoIndex = currentVideoIndex + 1;
          player.playVideoAt(nextVideoIndex);
        }
      }

      playlistButton.addEventListener("click", () => {
        let playlistLink = prompt(
          "Ingrese el enlace de la lista de reproducción:"
        );
        let playlistId = getPlaylistIdFromLink(playlistLink);

        if (playlistId) {
          getPlaylistVideos(playlistId);
          errorMessage.style.display = "none";
        } else {
          errorMessage.style.display = "block";
        }
      });

      function getPlaylistIdFromLink(link) {
        let playlistId;
        if (link.includes("list=")) {
          playlistId = link.split("list=")[1];
        } else {
          return null;
        }
        if (playlistId.includes("&")) {
          playlistId = playlistId.split("&")[0];
        }

        return playlistId;
      }

      function getPlaylistVideos(playlistId) {
        fetch(
          `https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&maxResults=50&playlistId=${playlistId}&key=AIzaSyCyYq3aWzXK-sE8surQuxZxCI2bZTzZtZA`
        )
          .then((response) => response.json())
          .then((data) => {
            let videos = data.items.map((item) => {
              let videoId = item.snippet.resourceId.videoId;
              let videoTitle = item.snippet.title;
              let videoDescription = item.snippet.description;

              return {
                id: videoId,
                title: videoTitle,
                description: videoDescription,
              };
            });

            updateVideoList(videos);
          })

          .catch((error) => console.error(error));
      }

      function updateVideoList(videos) {
        //videoList.innerHTML = '';
        videos.forEach((video) => {
          let option = document.createElement("option");
          option.value = video.id;
          option.text = video.description;
          option.textContent = video.title;
          videoList.appendChild(option);
        });
        videoList.addEventListener("change", () => {
          let selectedIndex = videoList.selectedIndex;
          let selectedOption = videoList.options[selectedIndex];
          let videoId = selectedOption.value;
          player.clearVideo(); // Borra el video actualmente en reproducción
          player.loadVideoById(videoId); // Carga el nuevo video
          description.textContent = selectedOption.text;
          titulo.innerHTML = selectedOption.textContent;
        });
      }

      updateButton.addEventListener("click", () => {
        getJSONVideos("playlist_0.json");
        let videoLink = videoLinkInput.value;
        let videoId = getVideoIdFromLink(videoLink);

        if (videoId) {
          player.loadVideoById(videoId);
          let option = document.createElement("option");
          option.text = videoLink;
          option.value = videoId;
          videoList.add(option);
          errorMessage.style.display = "none";
        } else {
          errorMessage.style.display = "block";
        }
      });

      function getVideoIdFromLink(link) {
        let videoId;
        if (link.includes("youtube.com/watch?v=")) {
          videoId = link.split("youtube.com/watch?v=")[1];
        } else if (link.includes("youtu.be/")) {
          videoId = link.split("youtu.be/")[1];
        } else {
          return null;
        }

        if (videoId.includes("&")) {
          videoId = videoId.split("&")[0];
        }

        return videoId;
      }

      videoList.addEventListener("change", () => {
        let selectedIndex = videoList.selectedIndex;
        let selectedOption = videoList.options[selectedIndex];
        let videoId = selectedOption.value;

        player.loadVideoById(videoId);
      });

      function getJSONVideos(jsonFile) {
        fetch(jsonFile)
          .then((response) => response.json())
          .then((data) => {
            let videos = [];
            data.forEach((item) => {
              let videoUrl = item.url;
              let videoTitle = item.title;
              let videoId = videoUrl.split("=")[1]; // Obtener el ID del video de la URL
              videos.push({ id: videoId, title: videoTitle });
            });
            updateVideoList(videos);
          })
          .catch((error) => console.error(error));
      }

      /////////////////////////////////////////////

      const fila = document.querySelector(".contenedor-carousel");
      const peliculas = document.querySelectorAll(".pelicula");

      const flechaIzquierda = document.getElementById("flecha-izquierda");
      const flechaDerecha = document.getElementById("flecha-derecha");

      // ? ----- ----- Event Listener para la flecha derecha. ----- -----
      flechaDerecha.addEventListener("click", () => {
        fila.scrollLeft += fila.offsetWidth;
        let selectedIndex = videoList.selectedIndex;
        let selectedOption = videoList.options[selectedIndex];
        let videoId = selectedOption.value;
        console.log(videoId);
        description.textContent = videoId.text;
        titulo.innerHTML = videoId.textContent;

        player.loadVideoById(videoId);
        if (selectedIndex < videoList.options.length - 1) {
          videoList.selectedIndex = selectedIndex + 1;
        }

        const indicadorActivo = document.querySelector(".indicadores .activo");
        if (indicadorActivo.nextSibling) {
          indicadorActivo.nextSibling.classList.add("activo");
          indicadorActivo.classList.remove("activo");
        }
      });

      // ? ----- ----- Event Listener para la flecha izquierda. ----- -----
      flechaIzquierda.addEventListener("click", () => {
        fila.scrollLeft -= fila.offsetWidth;
        let selectedIndex = videoList.selectedIndex;
        let selectedOption = videoList.options[selectedIndex];
        let videoId = selectedOption.value;
        console.log(videoId);
        description.textContent = videoId.text;
        titulo.innerHTML = videoId.textContent;

        player.loadVideoById(videoId);
        if (selectedIndex > 0) {
          videoList.selectedIndex = selectedIndex - 1;
        }

        const indicadorActivo = document.querySelector(".indicadores .activo");
        if (indicadorActivo.previousSibling) {
          indicadorActivo.previousSibling.classList.add("activo");
          indicadorActivo.classList.remove("activo");
        }
      });

      // ? ----- ----- Paginacion ----- -----
      const numeroPaginas = Math.ceil(peliculas.length / 5);
      for (let i = 0; i < numeroPaginas; i++) {
        const indicador = document.createElement("button");

        if (i === 0) {
          indicador.classList.add("activo");
        }

        document.querySelector(".indicadores").appendChild(indicador);
        indicador.addEventListener("click", (e) => {
          fila.scrollLeft = i * fila.offsetWidth;

          document
            .querySelector(".indicadores .activo")
            .classList.remove("activo");
          e.target.classList.add("activo");
        });
      }

      // ? ----- ----- Hover ----- -----
      peliculas.forEach((pelicula) => {
        pelicula.addEventListener("mouseenter", (e) => {
          const id = e.target.id;
          console.log(`Nuevo id de video: ${id}`);
          iFile.src = `https://drive.google.com/file/d/${id}/preview`;
          const elemento = e.currentTarget;

          iFile.id = id;
        });
      });

      fila.addEventListener("mouseleave", () => {
        peliculas.forEach((pelicula) => pelicula.classList.remove("hover"));
      });
    </script>

    <script>
      const loadButton = document.getElementById("loadButton");
      const inputFile = document.getElementById("inputFile");
      const videosContainer = document.getElementById("videosContainer");
      const iFile = document.querySelector("iframe");

      loadButton.addEventListener("click", () => {
        const file = inputFile.files[0];
        if (!file) {
          console.error("Archivo no seleccionado");
          return;
        }

        loadVideos();
      });

      // Función para cargar las imágenes y los videos en la página
      function loadVideos() {
        const inputFile = document.getElementById("inputFile");
        const videosContainer = document.getElementById("videosContainer");

        if (inputFile.files[0].type === "application/json") {
          // Verificar si el archivo es JSON
          const reader = new FileReader();
          reader.readAsText(inputFile.files[0]);
          reader.onload = (event) => {
            const content = event.target.result;
            const data = JSON.parse(content);
            let videos = [];
            data.forEach((item) => {
              let videoUrl = item.url;
              let videoTitle = item.title;
              let videoDescription = item.description;
              let videoId = videoUrl.split("=")[1]; // Obtener el ID del video de la URL
              videos.push({
                id: videoId,
                title: videoTitle,
                description: videoDescription,
              });
            });
            updateVideoList(videos);
          };
        } else {
          // Si el archivo no es JSON, tratarlo como archivo de texto plano
          const reader = new FileReader();
          reader.readAsText(inputFile.files[0]);
          reader.onload = (event) => {
            const content = event.target.result;
            const videos = content.split("\n");
            for (let video of videos) {
              const match = video.match(/\/d\/([-\w]+)/);
              if (match) {
                const videoId = match[1];
                const playlist = `
          <div class="pelicula">
            <a href="https://drive.google.com/file/d/${videoId}">
              <img id="${videoId}" src="https://drive.google.com/thumbnail?id=${videoId}&sz=w600-h338" alt="" title="${videoId}">
            </a>
          </div>
        `;
                videosContainer.innerHTML += playlist;
              } else {
                console.error(`El enlace ${video} no es válido.`);
              }
            }
            // Seleccionar la primera imagen por defecto
            const firstImg = document.querySelector(".pelicula img");
            firstImg.classList.add("hover");
            iFile.src = `https://drive.google.com/file/d/${firstImg.id}/preview`;
            iFile.id = firstImg.id;
          };
        }
      }
      
      videoList = document.getElementById("videoList");
      function onPlayerStateChange(event) {
        if (event.data === YT.PlayerState.ENDED) {
          let currentVideoIndex = player.getPlaylistIndex();
          let nextVideoIndex = currentVideoIndex + 1;
          player.playVideoAt(nextVideoIndex);

          // Seleccionar el siguiente video en la lista de reproducción
          videoList.selectedIndex = nextVideoIndex;
        }
      }
    </script>
    <script>
        var input = document.getElementById("videoLinkInput");
        function detectarEnlace() {
          navigator.clipboard.readText().then((texto) => {
            const expRegular = /(https?:\/\/)?(www\.)?(youtube\.com|youtu\.be)\/.+/;
            if (expRegular.test(texto)) {
              const enlace = texto.match(expRegular)[0];
              console.log(enlace);
              // asignar el enlace a una variable o hacer algo con él
              // Asignar el enlace al input
            input.value = enlace;
            } else {
              console.log("No se encontró un enlace de YouTube en el portapapeles");
            }
          });
        }

        //Creamos un listener para el evento focus
		input.addEventListener("focus", () => {
			//Obtenemos el contenido del portapapeles
			navigator.clipboard.readText()
				.then((text) => {
					//Si el contenido es un enlace de YouTube, lo agregamos al input y actualizamos video
					if (text.includes("youtube.com") || text.includes("youtu.be")) {
						videoLinkInput.value = text;
                        getJSONVideos("playlist_0.json");
                        let videoLink = videoLinkInput.value;
                        let videoId = getVideoIdFromLink(videoLink);

                        if (videoId) {
                        player.loadVideoById(videoId);
                        let option = document.createElement("option");
                        option.text = videoLink;
                        option.value = videoId;
                        videoList.add(option);
                        errorMessage.style.display = "none";
                        } else {
                        errorMessage.style.display = "block";
                        }
					}
				})
				.catch((err) => {
					console.error(err);
				});
		});
      </script>
      
  </body>
</html>





