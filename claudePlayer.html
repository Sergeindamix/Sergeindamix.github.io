<!DOCTYPE html>
<html>
<head>
  <title>Reproducir Playlist de YouTube</title>
</head>
<body>

  <video id="videoPlayer" controls crossorigin="anonymous" hidden>
    <source src="..." type="video/mp4">
  </video>

  <script>
    // Crea el elemento iframe
    let player; 
    // ID de los primeros 3 videos
    const videoIds = ['3yiVDrX6vG0', 'CrzGdIOqOJM', 'cmpRLQZkTb8']; 
    let currentVideoIndex = 0;
    // URL de la playlist
    const playlistUrl = 'https://www.youtube.com/playlist?list=PLk6yrJCXLVNGubc2vSTn85x4wxf2DNo0J&key=AIzaSyABAbMEP_2fcPg3m5ULfk51Unf_SmaHl3w';
    let nextVideo;
    
    function createPlayer() {
      player = document.createElement('iframe');
      player.width = 560;
      player.height = 315;
      player.src = 'https://www.youtube.com/embed/' + videoIds[currentVideoIndex];
      document.body.appendChild(player);
    }
      
    // Carga el primer video en el reproductor
    loadVideo(videoIds[currentVideoIndex]); 

    // Reproduce el siguiente video cuando termina el actual
    player.onended = function() {

      setTimeout(function() {
        
        loadNextVideo(); 
        
        playVideo();
      
      }, 6000); 
    
    }

    function playVideo() {
      player.play();
    }

    function loadNextVideo() {
      // obtén siguiente video
      currentVideoIndex++;
      // asigna siguiente video a player
      loadVideo(videoIds[currentVideoIndex]);
    }
    
    function loadVideo(videoId) {
      /*if (player) {
        player.remove(); 
      }
    
      createPlayer(videoIds[currentVideoIndex]);
      
      videoIds.shift();
      */
      
      nextVideo = getNextVideo(); // obtiene el siguiente video

      preloadVideo(nextVideo); // precarga en caché
    
      playVideo(videoId); // reproduce video actual
    }

    function preloadVideo(video) {

      let request = new XMLHttpRequest();
      request.open('GET', video.url);
      request.responseType = 'blob';
    
      request.onload = function() {
        cacheVideo(video, request.response); 
      }
    
      request.send();
    
    }

    function cacheVideo(video, data) {
      caches.open('video-cache').then(cache => {
        cache.put(video.url, new Response(data));
      });
    }
  </script>

</body>
</html>
